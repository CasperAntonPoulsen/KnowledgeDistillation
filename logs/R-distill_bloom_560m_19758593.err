Loaded module: cuda/12.1
/usr/lib64/python3.9/site-packages/scipy/__init__.py:138: UserWarning: A NumPy version >=1.16.5 and <1.23.0 is required for this version of SciPy (detected version 1.26.2)
  warnings.warn(f"A NumPy version >={np_minversion} and <{np_maxversion} is required for this version of "
Generation Evaluation:   0%|          | 0/124 [00:00<?, ?it/s]Generation Evaluation:   1%|          | 1/124 [00:01<03:29,  1.70s/it]Generation Evaluation:   2%|▏         | 2/124 [00:03<03:27,  1.70s/it]Generation Evaluation:   2%|▏         | 3/124 [00:05<03:25,  1.70s/it]Generation Evaluation:   3%|▎         | 4/124 [00:06<03:23,  1.70s/it]Generation Evaluation:   4%|▍         | 5/124 [00:08<03:22,  1.70s/it]Generation Evaluation:   5%|▍         | 6/124 [00:10<03:20,  1.70s/it]Generation Evaluation:   6%|▌         | 7/124 [00:11<03:18,  1.70s/it]Generation Evaluation:   6%|▋         | 8/124 [00:13<03:16,  1.70s/it]Generation Evaluation:   7%|▋         | 9/124 [00:15<03:14,  1.70s/it]Generation Evaluation:   8%|▊         | 10/124 [00:16<03:12,  1.69s/it]Generation Evaluation:   9%|▉         | 11/124 [00:18<03:11,  1.69s/it]Generation Evaluation:  10%|▉         | 12/124 [00:20<03:09,  1.70s/it]Generation Evaluation:  10%|█         | 13/124 [00:22<03:08,  1.70s/it]Generation Evaluation:  11%|█▏        | 14/124 [00:23<03:06,  1.70s/it]Generation Evaluation:  12%|█▏        | 15/124 [00:25<03:04,  1.69s/it]Generation Evaluation:  13%|█▎        | 16/124 [00:27<03:02,  1.69s/it]Generation Evaluation:  14%|█▎        | 17/124 [00:28<03:01,  1.70s/it]Generation Evaluation:  15%|█▍        | 18/124 [00:30<03:00,  1.70s/it]Generation Evaluation:  15%|█▌        | 19/124 [00:32<02:58,  1.70s/it]Generation Evaluation:  16%|█▌        | 20/124 [00:33<02:56,  1.70s/it]Generation Evaluation:  17%|█▋        | 21/124 [00:35<02:54,  1.70s/it]Generation Evaluation:  18%|█▊        | 22/124 [00:37<02:52,  1.69s/it]Generation Evaluation:  19%|█▊        | 23/124 [00:39<02:51,  1.69s/it]Generation Evaluation:  19%|█▉        | 24/124 [00:40<02:49,  1.69s/it]Generation Evaluation:  20%|██        | 25/124 [00:42<02:47,  1.69s/it]Generation Evaluation:  21%|██        | 26/124 [00:44<02:46,  1.69s/it]Generation Evaluation:  22%|██▏       | 27/124 [00:45<02:44,  1.69s/it]Generation Evaluation:  23%|██▎       | 28/124 [00:47<02:43,  1.70s/it]Generation Evaluation:  23%|██▎       | 29/124 [00:49<02:41,  1.70s/it]Generation Evaluation:  24%|██▍       | 30/124 [00:50<02:39,  1.70s/it]Generation Evaluation:  25%|██▌       | 31/124 [00:52<02:37,  1.70s/it]Generation Evaluation:  26%|██▌       | 32/124 [00:54<02:36,  1.70s/it]Generation Evaluation:  27%|██▋       | 33/124 [00:56<02:34,  1.70s/it]Generation Evaluation:  27%|██▋       | 34/124 [00:57<02:33,  1.70s/it]Generation Evaluation:  28%|██▊       | 35/124 [00:59<02:31,  1.70s/it]Generation Evaluation:  29%|██▉       | 36/124 [01:01<02:29,  1.70s/it]Generation Evaluation:  30%|██▉       | 37/124 [01:02<02:27,  1.70s/it]Generation Evaluation:  31%|███       | 38/124 [01:04<02:26,  1.70s/it]Generation Evaluation:  31%|███▏      | 39/124 [01:06<02:24,  1.70s/it]Generation Evaluation:  32%|███▏      | 40/124 [01:07<02:22,  1.70s/it]Generation Evaluation:  33%|███▎      | 41/124 [01:09<02:20,  1.70s/it]Generation Evaluation:  34%|███▍      | 42/124 [01:11<02:19,  1.70s/it]Generation Evaluation:  35%|███▍      | 43/124 [01:13<02:17,  1.70s/it]Generation Evaluation:  35%|███▌      | 44/124 [01:14<02:15,  1.70s/it]Generation Evaluation:  36%|███▋      | 45/124 [01:16<02:14,  1.70s/it]Generation Evaluation:  37%|███▋      | 46/124 [01:18<02:12,  1.70s/it]Generation Evaluation:  38%|███▊      | 47/124 [01:19<02:10,  1.69s/it]Generation Evaluation:  39%|███▊      | 48/124 [01:21<02:08,  1.70s/it]Generation Evaluation:  40%|███▉      | 49/124 [01:23<02:07,  1.69s/it]Generation Evaluation:  40%|████      | 50/124 [01:24<02:05,  1.69s/it]Generation Evaluation:  41%|████      | 51/124 [01:26<02:03,  1.70s/it]Generation Evaluation:  42%|████▏     | 52/124 [01:28<02:02,  1.70s/it]Generation Evaluation:  43%|████▎     | 53/124 [01:29<02:00,  1.70s/it]Generation Evaluation:  44%|████▎     | 54/124 [01:31<01:58,  1.70s/it]Generation Evaluation:  44%|████▍     | 55/124 [01:33<01:57,  1.70s/it]Generation Evaluation:  45%|████▌     | 56/124 [01:35<01:55,  1.70s/it]Generation Evaluation:  46%|████▌     | 57/124 [01:36<01:53,  1.70s/it]Generation Evaluation:  47%|████▋     | 58/124 [01:38<01:51,  1.70s/it]Generation Evaluation:  48%|████▊     | 59/124 [01:40<01:50,  1.70s/it]Generation Evaluation:  48%|████▊     | 60/124 [01:41<01:48,  1.69s/it]Generation Evaluation:  49%|████▉     | 61/124 [01:43<01:46,  1.70s/it]Generation Evaluation:  50%|█████     | 62/124 [01:45<01:45,  1.70s/it]Generation Evaluation:  51%|█████     | 63/124 [01:46<01:43,  1.70s/it]Generation Evaluation:  52%|█████▏    | 64/124 [01:48<01:41,  1.70s/it]Generation Evaluation:  52%|█████▏    | 65/124 [01:50<01:40,  1.70s/it]Generation Evaluation:  53%|█████▎    | 66/124 [01:52<01:38,  1.70s/it]Generation Evaluation:  54%|█████▍    | 67/124 [01:53<01:36,  1.70s/it]Generation Evaluation:  55%|█████▍    | 68/124 [01:55<01:35,  1.70s/it]Generation Evaluation:  56%|█████▌    | 69/124 [01:57<01:33,  1.70s/it]Generation Evaluation:  56%|█████▋    | 70/124 [01:58<01:31,  1.70s/it]Generation Evaluation:  57%|█████▋    | 71/124 [02:00<01:29,  1.70s/it]Generation Evaluation:  58%|█████▊    | 72/124 [02:02<01:28,  1.70s/it]Generation Evaluation:  59%|█████▉    | 73/124 [02:03<01:26,  1.70s/it]Generation Evaluation:  60%|█████▉    | 74/124 [02:05<01:24,  1.70s/it]Generation Evaluation:  60%|██████    | 75/124 [02:07<01:23,  1.70s/it]Generation Evaluation:  61%|██████▏   | 76/124 [02:09<01:21,  1.70s/it]Generation Evaluation:  62%|██████▏   | 77/124 [02:10<01:19,  1.70s/it]Generation Evaluation:  63%|██████▎   | 78/124 [02:12<01:17,  1.69s/it]Generation Evaluation:  64%|██████▎   | 79/124 [02:14<01:16,  1.69s/it]Generation Evaluation:  65%|██████▍   | 80/124 [02:15<01:14,  1.69s/it]Generation Evaluation:  65%|██████▌   | 81/124 [02:17<01:12,  1.69s/it]Generation Evaluation:  66%|██████▌   | 82/124 [02:19<01:11,  1.69s/it]Generation Evaluation:  67%|██████▋   | 83/124 [02:20<01:09,  1.69s/it]Generation Evaluation:  68%|██████▊   | 84/124 [02:22<01:07,  1.69s/it]Generation Evaluation:  69%|██████▊   | 85/124 [02:24<01:05,  1.69s/it]Generation Evaluation:  69%|██████▉   | 86/124 [02:25<01:04,  1.69s/it]Generation Evaluation:  70%|███████   | 87/124 [02:27<01:02,  1.69s/it]Generation Evaluation:  71%|███████   | 88/124 [02:29<01:01,  1.70s/it]Generation Evaluation:  72%|███████▏  | 89/124 [02:31<00:59,  1.70s/it]Generation Evaluation:  73%|███████▎  | 90/124 [02:32<00:57,  1.70s/it]Generation Evaluation:  73%|███████▎  | 91/124 [02:34<00:56,  1.70s/it]Generation Evaluation:  74%|███████▍  | 92/124 [02:36<00:54,  1.70s/it]Generation Evaluation:  75%|███████▌  | 93/124 [02:37<00:52,  1.70s/it]Generation Evaluation:  76%|███████▌  | 94/124 [02:39<00:50,  1.70s/it]Generation Evaluation:  77%|███████▋  | 95/124 [02:41<00:49,  1.70s/it]Generation Evaluation:  77%|███████▋  | 96/124 [02:42<00:47,  1.70s/it]Generation Evaluation:  78%|███████▊  | 97/124 [02:44<00:45,  1.70s/it]Generation Evaluation:  79%|███████▉  | 98/124 [02:46<00:44,  1.70s/it]Generation Evaluation:  80%|███████▉  | 99/124 [02:48<00:42,  1.70s/it]Generation Evaluation:  81%|████████  | 100/124 [02:49<00:40,  1.70s/it]Generation Evaluation:  81%|████████▏ | 101/124 [02:51<00:39,  1.70s/it]Generation Evaluation:  82%|████████▏ | 102/124 [02:53<00:37,  1.70s/it]Generation Evaluation:  83%|████████▎ | 103/124 [02:54<00:35,  1.70s/it]Generation Evaluation:  84%|████████▍ | 104/124 [02:56<00:34,  1.70s/it]Generation Evaluation:  85%|████████▍ | 105/124 [02:58<00:32,  1.70s/it]Generation Evaluation:  85%|████████▌ | 106/124 [02:59<00:30,  1.70s/it]Generation Evaluation:  86%|████████▋ | 107/124 [03:01<00:29,  1.71s/it]Generation Evaluation:  87%|████████▋ | 108/124 [03:03<00:27,  1.71s/it]Generation Evaluation:  88%|████████▊ | 109/124 [03:05<00:25,  1.71s/it]Generation Evaluation:  89%|████████▊ | 110/124 [03:06<00:23,  1.71s/it]Generation Evaluation:  90%|████████▉ | 111/124 [03:08<00:22,  1.70s/it]Generation Evaluation:  90%|█████████ | 112/124 [03:10<00:20,  1.70s/it]Generation Evaluation:  91%|█████████ | 113/124 [03:11<00:18,  1.70s/it]Generation Evaluation:  92%|█████████▏| 114/124 [03:13<00:17,  1.70s/it]Generation Evaluation:  93%|█████████▎| 115/124 [03:15<00:15,  1.70s/it]Generation Evaluation:  94%|█████████▎| 116/124 [03:16<00:13,  1.70s/it]Generation Evaluation:  94%|█████████▍| 117/124 [03:18<00:11,  1.70s/it]Generation Evaluation:  95%|█████████▌| 118/124 [03:20<00:10,  1.70s/it]Generation Evaluation:  96%|█████████▌| 119/124 [03:22<00:08,  1.70s/it]Generation Evaluation:  97%|█████████▋| 120/124 [03:23<00:06,  1.70s/it]Generation Evaluation:  98%|█████████▊| 121/124 [03:25<00:05,  1.70s/it]Generation Evaluation:  98%|█████████▊| 122/124 [03:27<00:03,  1.70s/it]Generation Evaluation:  99%|█████████▉| 123/124 [03:28<00:01,  1.70s/it]Generation Evaluation: 100%|██████████| 124/124 [03:30<00:00,  1.70s/it]Generation Evaluation: 100%|██████████| 124/124 [03:30<00:00,  1.70s/it]
LM Evaluation:   0%|          | 0/125 [00:00<?, ?it/s]LM Evaluation:   1%|          | 1/125 [00:00<00:15,  7.97it/s]LM Evaluation:   2%|▏         | 3/125 [00:00<00:10, 12.15it/s]LM Evaluation:   4%|▍         | 5/125 [00:00<00:08, 13.52it/s]LM Evaluation:   6%|▌         | 7/125 [00:00<00:08, 14.16it/s]LM Evaluation:   7%|▋         | 9/125 [00:00<00:07, 14.52it/s]LM Evaluation:   9%|▉         | 11/125 [00:00<00:07, 14.74it/s]LM Evaluation:  10%|█         | 13/125 [00:00<00:07, 14.86it/s]LM Evaluation:  12%|█▏        | 15/125 [00:01<00:07, 14.97it/s]LM Evaluation:  14%|█▎        | 17/125 [00:01<00:07, 15.02it/s]LM Evaluation:  15%|█▌        | 19/125 [00:01<00:07, 15.06it/s]LM Evaluation:  17%|█▋        | 21/125 [00:01<00:06, 15.11it/s]LM Evaluation:  18%|█▊        | 23/125 [00:01<00:06, 15.10it/s]LM Evaluation:  20%|██        | 25/125 [00:01<00:06, 15.11it/s]LM Evaluation:  22%|██▏       | 27/125 [00:01<00:06, 15.11it/s]LM Evaluation:  23%|██▎       | 29/125 [00:01<00:06, 15.09it/s]LM Evaluation:  25%|██▍       | 31/125 [00:02<00:06, 15.11it/s]LM Evaluation:  26%|██▋       | 33/125 [00:02<00:06, 15.10it/s]LM Evaluation:  28%|██▊       | 35/125 [00:02<00:05, 15.09it/s]LM Evaluation:  30%|██▉       | 37/125 [00:02<00:05, 15.08it/s]LM Evaluation:  31%|███       | 39/125 [00:02<00:05, 15.07it/s]LM Evaluation:  33%|███▎      | 41/125 [00:02<00:05, 15.09it/s]LM Evaluation:  34%|███▍      | 43/125 [00:02<00:05, 15.08it/s]LM Evaluation:  36%|███▌      | 45/125 [00:03<00:05, 15.09it/s]LM Evaluation:  38%|███▊      | 47/125 [00:03<00:05, 15.11it/s]LM Evaluation:  39%|███▉      | 49/125 [00:03<00:05, 15.11it/s]LM Evaluation:  41%|████      | 51/125 [00:03<00:04, 15.09it/s]LM Evaluation:  42%|████▏     | 53/125 [00:03<00:04, 15.09it/s]LM Evaluation:  44%|████▍     | 55/125 [00:03<00:04, 15.06it/s]LM Evaluation:  46%|████▌     | 57/125 [00:03<00:04, 15.07it/s]LM Evaluation:  47%|████▋     | 59/125 [00:03<00:04, 15.08it/s]LM Evaluation:  49%|████▉     | 61/125 [00:04<00:04, 15.06it/s]LM Evaluation:  50%|█████     | 63/125 [00:04<00:04, 15.07it/s]LM Evaluation:  52%|█████▏    | 65/125 [00:04<00:03, 15.06it/s]LM Evaluation:  54%|█████▎    | 67/125 [00:04<00:03, 15.05it/s]LM Evaluation:  55%|█████▌    | 69/125 [00:04<00:03, 15.06it/s]LM Evaluation:  57%|█████▋    | 71/125 [00:04<00:03, 15.06it/s]LM Evaluation:  58%|█████▊    | 73/125 [00:04<00:03, 15.05it/s]LM Evaluation:  60%|██████    | 75/125 [00:05<00:03, 15.08it/s]LM Evaluation:  62%|██████▏   | 77/125 [00:05<00:03, 15.07it/s]LM Evaluation:  63%|██████▎   | 79/125 [00:05<00:03, 15.08it/s]LM Evaluation:  65%|██████▍   | 81/125 [00:05<00:02, 15.08it/s]LM Evaluation:  66%|██████▋   | 83/125 [00:05<00:02, 15.07it/s]LM Evaluation:  68%|██████▊   | 85/125 [00:05<00:02, 15.09it/s]LM Evaluation:  70%|██████▉   | 87/125 [00:05<00:02, 15.09it/s]LM Evaluation:  71%|███████   | 89/125 [00:05<00:02, 15.08it/s]LM Evaluation:  73%|███████▎  | 91/125 [00:06<00:02, 15.10it/s]LM Evaluation:  74%|███████▍  | 93/125 [00:06<00:02, 15.08it/s]LM Evaluation:  76%|███████▌  | 95/125 [00:06<00:01, 15.07it/s]LM Evaluation:  78%|███████▊  | 97/125 [00:06<00:01, 15.07it/s]LM Evaluation:  79%|███████▉  | 99/125 [00:06<00:01, 15.05it/s]LM Evaluation:  81%|████████  | 101/125 [00:06<00:01, 15.07it/s]LM Evaluation:  82%|████████▏ | 103/125 [00:06<00:01, 15.08it/s]LM Evaluation:  84%|████████▍ | 105/125 [00:07<00:01, 15.09it/s]LM Evaluation:  86%|████████▌ | 107/125 [00:07<00:01, 15.10it/s]LM Evaluation:  87%|████████▋ | 109/125 [00:07<00:01, 15.08it/s]LM Evaluation:  89%|████████▉ | 111/125 [00:07<00:00, 15.10it/s]LM Evaluation:  90%|█████████ | 113/125 [00:07<00:00, 15.10it/s]LM Evaluation:  92%|█████████▏| 115/125 [00:07<00:00, 15.07it/s]LM Evaluation:  94%|█████████▎| 117/125 [00:07<00:00, 15.07it/s]LM Evaluation:  95%|█████████▌| 119/125 [00:07<00:00, 15.05it/s]LM Evaluation:  97%|█████████▋| 121/125 [00:08<00:00, 15.05it/s]LM Evaluation:  98%|█████████▊| 123/125 [00:08<00:00, 15.06it/s]LM Evaluation: 100%|██████████| 125/125 [00:08<00:00, 15.06it/s]LM Evaluation: 100%|██████████| 125/125 [00:08<00:00, 14.98it/s]
/zhome/4e/b/208805/.local/lib/python3.9/site-packages/torch/utils/checkpoint.py:429: UserWarning: torch.utils.checkpoint: please pass in use_reentrant=True or use_reentrant=False explicitly. The default value of use_reentrant will be updated to be False in the future. To maintain current behavior, pass use_reentrant=True. It is recommended that you use use_reentrant=False. Refer to docs for more details on the differences between the two variants.
  warnings.warn(
/zhome/4e/b/208805/.local/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py:1881: UserWarning: The torch.cuda.*DtypeTensor constructors are no longer recommended. It's best to use methods such as torch.tensor(data, dtype=*, device='cuda') to create tensors. (Triggered internally at ../torch/csrc/tensor/python_tensor.cpp:83.)
  overflow_gpu = get_accelerator().ByteTensor([overflow])
Traceback (most recent call last):
  File "/dtu/p1/johlau/LMOps/minillm/train_minillm.py", line 93, in <module>
    main()
  File "/dtu/p1/johlau/LMOps/minillm/train_minillm.py", line 79, in main
    train(
  File "/dtu/p1/johlau/LMOps/minillm/minillm/__init__.py", line 51, in train
    trainer.train()
  File "/dtu/p1/johlau/LMOps/minillm/minillm/trainer.py", line 291, in train
    self.model.step()
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 2129, in step
    self._take_model_step(lr_kwargs)
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 2035, in _take_model_step
    self.optimizer.step()
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 1712, in step
    self._update_scale(self.overflow)
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 1963, in _update_scale
    self.loss_scaler.update_scale(has_overflow)
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/deepspeed/runtime/fp16/loss_scaler.py", line 175, in update_scale
    raise Exception(
Exception: Current loss scale already at minimum - cannot decrease scale anymore. Exiting run.
[2023-12-12 16:50:44,714] torch.distributed.elastic.multiprocessing.api: [ERROR] failed (exitcode: 1) local_rank: 0 (pid: 1950199) of binary: /bin/python3
Traceback (most recent call last):
  File "/usr/lib64/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib64/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/torch/distributed/run.py", line 810, in <module>
    main()
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 346, in wrapper
    return f(*args, **kwargs)
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/torch/distributed/run.py", line 806, in main
    run(args)
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/torch/distributed/run.py", line 797, in run
    elastic_launch(
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 134, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/zhome/4e/b/208805/.local/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 264, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/dtu/p1/johlau/LMOps/minillm/train_minillm.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-12-12_16:50:44
  host      : n-62-12-86.hpccluster.dtu.dk
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 1950199)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
